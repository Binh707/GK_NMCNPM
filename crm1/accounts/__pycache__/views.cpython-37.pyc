B
    Ü›^  ã               @   s  d dl mZmZ d dlmZ d dlmZ d dl mZ d dl	m
Z
m
Z
mZ d dl
mZ d d lmZ dd	lT dd
lmZmZ dd
lmZ dd
„ Zdd„ Zdd„ Zedddd„ ƒZedddd„ ƒZedddd„ ƒZedddd„ ƒZedddd„ ƒZedddd„ ƒZd S )!é    )ÚrenderÚredirect)ÚHttpResponse)Úinlineformset_factory)ÚUserCreationForm)ÚauthenticateÚloginÚlogout)Úmessages)Úlogin_requiredé   )Ú*)Ú	OrderFormÚCreateUserForm)Ú
OrderFilterc             C   sv   | j jrtdƒS tƒ }| jdkr^t| jƒ}| ¡ r^|  ¡  |j 	d¡}t
 
| d| ¡ tdƒS d|i}t| d |ƒS d S )NÚhomeÚPOSTÚusernamezAccount was created for r   Úformzaccounts/register.html)
ÚuserÚis_authenticatedr   r   Úmethodr   Úis_validÚsaveÚcleaned_dataÚgetr
   Ú successr   )Ú requestr   r   Ú context© r   ú6C:\Users\denni\OneDrive\Desktop\crm1\accounts\views.pyÚregisterPage   s    

r!   c             C   sz   | j jrtdƒS | jdkrf| j d¡}| j d¡}t| ||d}|d k	rZt | |ƒ tdƒS t 	| d¡ i }t
| d |ƒS d S )Nr   r   r   Úpassword)r   r"   z!Username OR password is incorrectzaccounts/login.html)
r   r   r   r   r   r   r    r   r
   Úinfor   )r   r   r"   r   r   r   r   r    Ú	loginPage#   s    

r$   c             C   s   t | ƒ tdƒS )Nr   )r	   r   )r   r   r   r    Ú
logoutUser6   s    r%   r   )Z	login_urlc             C   s`   t j ¡ }tj ¡ }| ¡ }| ¡ }|jdd ¡ }|jdd ¡ }|||||dœ} t| d| ƒS )NÚ	Delivered)ÚstatusÚ Pending)ÚordersÚ	customersÚtotal_ordersÚ	deliveredÚ pendingzaccounts/dashboard.html) ÚOrderÚ objectsÚallÚCustomerÚcountÚfilterr   )r   r)   r*   Ztotal_customersr+   r,   r-   r   r   r   r    r   ;   s    

r   c             C   s   t j ¡ }t| dd|iƒS )Nzaccounts/products.htmlÚproducts)Ú Productr/   r0   r   )r   r4   r   r   r    r4   L   s    
r4   c              C   sN   t jj|d}|j ¡ }| ¡ }t| j |d}|j}||||dœ}t	| d|ƒS )N)Úid)Úqueryset)Úcustomerr)   Ú
order_countÚmyFilterzaccounts/customer.html)
r1   r/   r   Ú	order_setr0   r2   r   ÚGETÚqsr   ) r   Z pk_testr8   r)   r9   r:   r   r   r   r    r8   R   s    
r8   c              C   s~   t ttddd}tjj|d}|tj ¡ |d}| jdkrjt | jƒ}|| j|d }| 	¡ rj| 
¡  t
dƒS d	|i}t| d
|ƒS )
N)Ú productr'   é
   )ÚfieldsÚextra)r6   )r7   Úinstancer   )rB   ú/r   zaccounts/order_form.html)
r   r1   r.   r/   r   Únoner   r   r   r   r   r   r   ) r   ÚpkZOrderFormSetr8   Ú formsetr   r   r   r   r    Ú
createOrder`   s    

rG   c             C   s\   t jj|d}t|d}| jdkrHt| j|d}| ¡ rH|  ¡  tdƒS d|i}t	| d|ƒS ) N)r6   )rB   r   rC   r   zaccounts/order_form.html)
r.   r/   r   r   r   r   r   r   r   r   )r   rE   Úorderr   r   r   r   r    Ú
updateOrderq   s    

rI   c             C   s<   t jj|d}| jdkr(| ¡  tdƒS d|i}t| d|ƒS )N)r6   r   rC   Úitemzaccounts/delete.html) r.   r/   r   r   Údeleter   r   )r   rE   rH   r   r   r   r    Ú
deleteOrder€   s    
rL   N) Zdjango.shortcutsr   r   Ú
django.httpr   Zdjango.formsr   Údjango.contrib.auth.formsr   Údjango.contrib.authr    r   r	   Údjango.contribr
   Zdjango.contrib.auth.decoratorsr
   ÚmodelsÚformsr   r   Ú filtersr   r!   r$   r%   r   r4   r8   rG   rI   rL   r   r   r   r    Ú<module>   s$   